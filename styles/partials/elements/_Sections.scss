@mixin section--heading-bottom-margin($m) {
  &.text--#{$m} + * {
    margin-top: var(--font-margin-bottom-#{$m});
  }
  &.text--#{$m} + *.mt-less {
    margin-top: var(--font-margin-bottom-#{$m}_less);
  }
}

@mixin section-chapter-wrapper {
  margin-top: var(--section-gap);
  position: relative;
}

:root {
  --section-gap: 12.5rem;
  --section-gap_half: calc(var(--section-gap) / 2);
}

.chapter {
  &--wrapper {
    @include section-chapter-wrapper;
  }
}

.section {
  --section-text-spacing: 1.25rem;
  --section-graphic-panel-pad: 2.5rem;
  // --section-column-arrow-height: 1.7rem;

  &--wrapper {
    @include section-chapter-wrapper;
  }

  @include flex-row;

  &--title {
    & + * {
      margin-top: var(--font-margin-bottom-h4);
    }
  }

  &--heading {
    @include section--heading-bottom-margin(h1);
    @include section--heading-bottom-margin(h2);
    @include section--heading-bottom-margin(h3);
    @include section--heading-bottom-margin(h4);
  }

  &--copy {
    @include flex-col-center;
  }

  &--description {
    & > * + * {
      margin-top: var(--section-text-spacing);
    }

    ol,ul {
      --counter-width: 1.5rem;
      & > * + * {
        margin-top: var(--section-text-spacing);
      }
      & > * + *.mt-less {
        margin-top: calc(var(--section-text-spacing) * 0.35);
      }

      list-style-position: inside;
    }

    li {
      span {
        display: block;
        margin-top: calc(var(--font-height-body) * -1);
        width: calc(100% - var(--counter-width));
        padding-left: var(--counter-width);
      }
    }

    &__color {
      padding: 2.25rem;
    }
  }

  .graphic {

    --img-panel-height: 12rem;

    --graphic-width: #{mask-width(11.5rem)};
    --graphic-height: calc((var(--graphic-width)) * (var(--mask-aspect-height) / var(--mask-aspect-width)));

    
    &--panel {
      height: var(--img-panel-height);
      @include b-rad;
      @include flex-row-center;
      padding: var(--section-graphic-panel-pad);
      align-items: center;

      .mask {
        height: fit-content;
        height: var(--graphic-height);
        width: var(--graphic-width);
        background-color: $col-tertiary;
      }

      &__flexible {
        height: 100% !important;
        padding: 0;
      }
    }

    &--caption {
      margin-top: var(--section-text-spacing);
    }

    img {
      @include img-contain;
    }
  }

  &--main {
    @include flex-row;
    margin-top: calc(var(--section-text-spacing) * 1.75);

    &.mt-less {
      margin-top: calc(var(--section-text-spacing) * 1.25);
    }
  }

  &--quote {
    * {
      @include quote;
    }

    &__color {
      padding: 1.875rem;
    }
  }

  .column {
    &--arrow {
      position: absolute;
      .mask {
        --arrow-width: #{mask-width(1.5rem)};
        // --arrow-height: #{mask-height(1.5rem)};

        --arrow-height: calc(var(--arrow-width) * (var(--mask-aspect-height) / var(--mask-aspect-width)));

        // --arrow-height: calc((var(--arrow-width)) * (var(--mask-aspect-height) / var(--mask-aspect-width)))

        height: var(--arrow-height) !important;
        width: var(--arrow-width) !important;
        background-color: $col-primary !important;
        margin-top: calc(((var(--section-graphic-panel-pad) * 2) + var(--img-panel-height) - var(--arrow-height)) / 2);
        margin-left: calc(((var(--gap) + var(--arrow-width)) / 2) * -1);
      }
    }
  }
}

// Type variants
.section {
  &__overview {
    justify-content: space-between;

    --gap: 6rem;
    @include gap;

    .section--graphic {
      opacity: 0.3;
    }
  }

  &__pitch {
    @include flex-row-between;
    --gap: 10rem;
    @include gap;

    .section--heading {
      margin-top: calc(var(--section-text-spacing) * 2);
      & + * {
        margin-top: 0;
      }
    }

    .section--description {
      margin-top: 0.5rem;
      * {
        @include h3;
        @include weight-reg;
      }
    }

    .section--graphic {
      // padding-left: 2rem;
    }

    .mask {
      // --mask-aspect-width;
      // --mask-aspect-height;
      --mask-size: 7.5rem;
      @include mask-width(var(--mask-size));
    }
  }
}

// Color variants

.section {
  &__color,
  &__image {
    @include pad-y(var(--section-gap));

    &:not(.background__background) * {
      color: $col-background;
    }

    & + & {
      margin-top: 0;
    }
  }
}

.chapter {
  &__color {
    // TODO: fix this ugly ass selector
    & > * > *:not(.background__background) {
      * {
        color: $col-background;
      }
      .mask {
        background-color: $col-background;
      }
    }
  }
}

.background {
  &__color {
  }

  &__background {
    background-color: $col-background;
  }

  &__background-darker {
    background-color: $col-background_darker;
    & + & {
      padding-top: 0;
    }
  }

  &__background-darkest {
    background-color: $col-background_darkest;
    & + & {
      padding-top: 0;
    }
  }

  &__primary {
    background-color: $col-primary;
    & + & {
      padding-top: 0;
    }
  }

  &__makeright-tertiary {
    background-color: $col-tertiary_makeright;
    & + & {
      padding-top: 0;
    }
  }
}
